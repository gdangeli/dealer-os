# WhatsApp Setup Wizard Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROGRESS BAR [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 12%                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: WILLKOMMEN ğŸš€                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Welcome message                                                â”‚
â”‚ â€¢ Benefits overview                                              â”‚
â”‚ â€¢ Estimated time: 15-20 min                                      â”‚
â”‚ â€¢ [Los geht's â†’]                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: META BUSINESS ACCOUNT ğŸ¢                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Instructions with link to business.facebook.com               â”‚
â”‚ â€¢ [Open business.facebook.com â†—]                                â”‚
â”‚ â€¢ â˜‘ Ich habe einen Meta Business Account                        â”‚
â”‚ â€¢ [?] Help: "Was ist ein Meta Business Account?"                â”‚
â”‚ â€¢ [â† ZurÃ¼ck] [Weiter â†’]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: DEVELOPER APP ğŸ’»                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Instructions for app creation                                  â”‚
â”‚ â€¢ [Open developers.facebook.com â†—]                              â”‚
â”‚ â€¢ App type: Business                                             â”‚
â”‚ â€¢ Add WhatsApp product                                           â”‚
â”‚ â€¢ â˜‘ App erstellt und WhatsApp hinzugefÃ¼gt                       â”‚
â”‚ â€¢ [â† ZurÃ¼ck] [Weiter â†’]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: TELEFONNUMMER ğŸ“±                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ â”‚ â—‹ Option A:          â”‚ â”‚ âœ“ Option B:          â”‚              â”‚
â”‚ â”‚   Test-Nummer        â”‚ â”‚   Eigene Nummer      â”‚              â”‚
â”‚ â”‚   (Testing)          â”‚ â”‚   (Produktion)       â”‚              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚ Phone Number ID: [_______________]                               â”‚
â”‚ WABA ID:        [_______________]                                â”‚
â”‚ (Optional) Phone: [_______________]                              â”‚
â”‚ â€¢ [â† ZurÃ¼ck] [Weiter â†’]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: ACCESS TOKEN ğŸ”‘                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Instructions: System User â†’ Token generieren                  â”‚
â”‚ â€¢ Required permissions:                                          â”‚
â”‚   - whatsapp_business_management                                â”‚
â”‚   - whatsapp_business_messaging                                 â”‚
â”‚                                                                  â”‚
â”‚ Access Token: [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]                             â”‚
â”‚                                                                  â”‚
â”‚ [Test Token ğŸ”]                                                  â”‚
â”‚                                                                  â”‚
â”‚ âœ… Token erfolgreich getestet!                                   â”‚
â”‚                                                                  â”‚
â”‚ â€¢ [â† ZurÃ¼ck] [Weiter â†’]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: WEBHOOK ğŸ”—                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Webhook URL:                                                     â”‚
â”‚ [https://dealer-os.ch/api/webhooks/whatsapp] [ğŸ“‹ Copy]         â”‚
â”‚                                                                  â”‚
â”‚ Verify Token:                                                    â”‚
â”‚ [dealer-os-abc123-xyz789] [ğŸ“‹ Copy]                             â”‚
â”‚                                                                  â”‚
â”‚ â€¢ Instructions: Where to enter in Meta                           â”‚
â”‚ â€¢ [Open WhatsApp App Config â†—]                                  â”‚
â”‚ â€¢ â˜‘ Webhook konfiguriert                                         â”‚
â”‚ â€¢ [â† ZurÃ¼ck] [Weiter â†’]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: TEST-NACHRICHT ğŸ“¨                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Test-Telefonnummer: [+41791234567]                              â”‚
â”‚                                                                  â”‚
â”‚ [Test-Nachricht senden ğŸ“¤]                                       â”‚
â”‚                                                                  â”‚
â”‚ âœ… Test-Nachricht erfolgreich gesendet!                          â”‚
â”‚                                                                  â”‚
â”‚ â€¢ [â† ZurÃ¼ck] [Weiter â†’]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: FERTIG! ğŸ‰                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Zusammenfassung Ihrer Konfiguration:                             â”‚
â”‚ âœ… Telefonnummer: +41 79 123 45 67                               â”‚
â”‚ âœ… Phone Number ID: 123456789012345                              â”‚
â”‚ âœ… WABA ID: 123456789012345                                      â”‚
â”‚ âœ… Access Token: Konfiguriert                                    â”‚
â”‚ âœ… Webhook: Konfiguriert                                         â”‚
â”‚                                                                  â”‚
â”‚ [Konfiguration speichern und abschlieÃŸen ğŸ’¾]                    â”‚
â”‚                                                                  â”‚
â”‚ Nach dem Speichern:                                              â”‚
â”‚ â†’ WhatsApp Conversations                                         â”‚
â”‚ â†’ Auto-Reply konfigurieren                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    Configuration Saved!
                              â†“
              Redirect to WhatsApp Conversations
```

## Progress Indicators

```
Step 1: â—â”â”â”â”â”â”â”  (12.5%)
Step 2: â—â—â”â”â”â”â”â”  (25%)
Step 3: â—â—â—â”â”â”â”â”  (37.5%)
Step 4: â—â—â—â—â”â”â”â”  (50%)
Step 5: â—â—â—â—â—â”â”â”  (62.5%)
Step 6: â—â—â—â—â—â—â”â”  (75%)
Step 7: â—â—â—â—â—â—â—â”  (87.5%)
Step 8: â—â—â—â—â—â—â—â—  (100%)
```

## Validation Flow

```
Step 1 â†’ Always proceed
Step 2 â†’ Require: hasMetaAccount = true
Step 3 â†’ Require: hasAppCreated = true
Step 4 â†’ Require: phoneNumberType selected + phoneNumberId filled
Step 5 â†’ Require: accessToken filled + testSuccess = true
Step 6 â†’ Require: webhookConfigured = true
Step 7 â†’ No validation (optional test)
Step 8 â†’ Save to database
```

## API Calls

```
Step 5: POST /api/whatsapp/test-connection
        Body: { accessToken, phoneNumberId }
        Response: { success, displayName, status }

Step 7: POST /api/whatsapp/send
        Body: { phoneNumberId, accessToken, to, message }
        Response: { success, message_id }

Step 8: Supabase INSERT/UPSERT
        Table: whatsapp_connections
        On conflict: dealer_id
```

## Component Architecture

```
SetupWizard (setup-wizard.tsx)
â”œâ”€â”€ State Management
â”‚   â”œâ”€â”€ currentStep (1-8)
â”‚   â”œâ”€â”€ wizardData (WizardData interface)
â”‚   â”œâ”€â”€ isLoading
â”‚   â”œâ”€â”€ testSuccess
â”‚   â””â”€â”€ clipboard states
â”‚
â”œâ”€â”€ Functions
â”‚   â”œâ”€â”€ nextStep() - Navigate forward with validation
â”‚   â”œâ”€â”€ prevStep() - Navigate backward
â”‚   â”œâ”€â”€ canGoNext() - Validation logic per step
â”‚   â”œâ”€â”€ renderStep() - Switch case for step content
â”‚   â”œâ”€â”€ testToken() - API call to test connection
â”‚   â”œâ”€â”€ sendTestMessage() - API call to send test
â”‚   â”œâ”€â”€ copyToClipboard() - Copy utility with feedback
â”‚   â””â”€â”€ saveConfiguration() - Final save to Supabase
â”‚
â””â”€â”€ UI Components
    â”œâ”€â”€ Progress Bar (top)
    â”œâ”€â”€ Step Content (cards)
    â”œâ”€â”€ Navigation Buttons (bottom)
    â””â”€â”€ Step Dots (visual indicator)
```

## Integration with Existing Code

```
WhatsAppSettingsClient
â”œâ”€â”€ State: useWizard (boolean)
â”œâ”€â”€ If no connection â†’ Show wizard by default
â”œâ”€â”€ If connection exists â†’ Show settings + "Start Wizard" button
â”œâ”€â”€ On wizard complete â†’ Refresh connection + hide wizard
â””â”€â”€ Toggle: Advanced Setup â†” Wizard
```
